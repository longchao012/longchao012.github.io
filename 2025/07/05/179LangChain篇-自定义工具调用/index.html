<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mzfnai.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"搜索文章","hits_empty":"我们没有找到任何搜索结果：${query}","hits_stats":"找到${hits}个结果，耗时${time}毫秒"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="详细介绍LangChain自定义工具调用的实现方法，包括@tool装饰器、StructuredTool和BaseTool的使用技巧。">
<meta property="og:type" content="article">
<meta property="og:title" content="LangChain篇-自定义工具调用">
<meta property="og:url" content="http://mzfnai.com/2025/07/05/179LangChain%E7%AF%87-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/index.html">
<meta property="og:site_name" content="妙知赋能AI longchao&#39;s Blog">
<meta property="og:description" content="详细介绍LangChain自定义工具调用的实现方法，包括@tool装饰器、StructuredTool和BaseTool的使用技巧。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-05T03:42:58.000Z">
<meta property="article:modified_time" content="2025-09-08T03:52:50.005Z">
<meta property="article:author" content="longchao">
<meta property="article:tag" content="LangChain">
<meta property="article:tag" content="自定义工具">
<meta property="article:tag" content="Tool装饰器">
<meta property="article:tag" content="Agent工具">
<meta property="article:tag" content="StructuredTool">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://mzfnai.com/2025/07/05/179LangChain%E7%AF%87-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>LangChain篇-自定义工具调用 | 妙知赋能AI longchao's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">妙知赋能AI longchao's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">A blog about life</p>
      <a>
        <img class="custom-logo-image" src="/uploads/custom-logo.jpg" alt="妙知赋能AI longchao's Blog">
      </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://mzfnai.com/2025/07/05/179LangChain%E7%AF%87-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="longchao">
      <meta itemprop="description" content="A blog about life, technology, and everything in between.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="妙知赋能AI longchao's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LangChain篇-自定义工具调用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-05 11:42:58" itemprop="dateCreated datePublished" datetime="2025-07-05T11:42:58+08:00">2025-07-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/LangChain/" itemprop="url" rel="index"><span itemprop="name">LangChain</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>
            <div class="post-description">详细介绍LangChain自定义工具调用的实现方法，包括@tool装饰器、StructuredTool和BaseTool的使用技巧。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、自定义工具"><a href="#一、自定义工具" class="headerlink" title="一、自定义工具"></a>一、自定义工具</h2><p>在构建代理时，您需要为其提供一个 <code>Tool</code> 列表，以便代理可以使用这些工具。除了实际调用的函数之外，<code>Tool</code> 由几个组件组成：</p>
<p>LangChain 提供了三种创建工具的方式：</p>
<ul>
<li>使用 <a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/tools/langchain_core.tools.tool.html#langchain_core.tools.tool">@tool装饰器</a> – 定义自定义工具的最简单方式。</li>
<li>使用 <a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/tools/langchain_core.tools.StructuredTool.html#langchain_core.tools.StructuredTool.from_function">StructuredTool.from_function</a> 类方法 – 这类似于 <code>@tool</code>装饰器，但允许更多配置和同步和异步实现的规范。</li>
<li>通过子类化<a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/tools/langchain_core.tools.BaseTool.html">BaseTool</a> – 这是最灵活的方法，它提供了最大程度的控制，但需要更多的工作量和代码。<code>@tool</code> 或 <code>StructuredTool.from_function</code> 类方法对于大多数用例应该足够了。 提示 如果工具具有精心选择的名称、描述和 JSON 模式，模型的性能会更好。</li>
</ul>
<h3 id="1-tool-装饰器"><a href="#1-tool-装饰器" class="headerlink" title="1. @tool 装饰器"></a>1. @tool 装饰器</h3><p>这个 <code>@tool</code> 装饰器是定义自定义工具的最简单方式。该装饰器默认使用函数名称作为工具名称，但可以通过传递字符串作为第一个参数来覆盖。此外，装饰器将使用函数的文档字符串作为工具的描述 - 因此必须提供文档字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例：tools_decorator.py</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"><span class="comment"># 检查与该工具关联的一些属性</span></span><br><span class="line"><span class="built_in">print</span>(multiply.name)</span><br><span class="line"><span class="built_in">print</span>(multiply.description)</span><br><span class="line"><span class="built_in">print</span>(multiply.args)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multiply</span><br><span class="line">multiply(a: int, b: int) -&gt; int - Multiply two numbers.</span><br><span class="line">&#123;&#x27;a&#x27;: &#123;&#x27;title&#x27;: &#x27;A&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;, &#x27;b&#x27;: &#123;&#x27;title&#x27;: &#x27;B&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>或者创建一个<strong>异步</strong>实现，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例：tools_async.py</span></span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">amultiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br></pre></td></tr></table></figure>

<p>您还可以通过将它们传递给工具装饰器来自定义工具名称和 JSON 参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CalculatorInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    a: <span class="built_in">int</span> = Field(description=<span class="string">&quot;first number&quot;</span>)</span><br><span class="line">    b: <span class="built_in">int</span> = Field(description=<span class="string">&quot;second number&quot;</span>)</span><br><span class="line"><span class="meta">@tool(<span class="params"><span class="string">&quot;multiplication-tool&quot;</span>, args_schema=CalculatorInput, return_direct=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"><span class="comment"># 检查与该工具关联的一些属性</span></span><br><span class="line"><span class="built_in">print</span>(multiply.name)</span><br><span class="line"><span class="built_in">print</span>(multiply.description)</span><br><span class="line"><span class="built_in">print</span>(multiply.args)</span><br><span class="line"><span class="built_in">print</span>(multiply.return_direct)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">multiplication-tool</span><br><span class="line">multiplication-tool(a: int, b: int) -&gt; int - Multiply two numbers.</span><br><span class="line">&#123;&#x27;a&#x27;: &#123;&#x27;title&#x27;: &#x27;A&#x27;, &#x27;description&#x27;: &#x27;first number&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;, &#x27;b&#x27;: &#123;&#x27;title&#x27;: &#x27;B&#x27;, &#x27;description&#x27;: &#x27;second number&#x27;, &#x27;type&#x27;: &#x27;integer&#x27;&#125;&#125;</span><br><span class="line">True</span><br></pre></td></tr></table></figure>

<h3 id="2-StructuredTool"><a href="#2-StructuredTool" class="headerlink" title="2. StructuredTool"></a>2. StructuredTool</h3><p><code>StructuredTool.from_function</code> 类方法提供了比 <code>@tool</code> 装饰器更多的可配置性，而无需太多额外的代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> StructuredTool</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">amultiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    calculator = StructuredTool.from_function(func=multiply, coroutine=amultiply)</span><br><span class="line">    <span class="built_in">print</span>(calculator.invoke(&#123;<span class="string">&quot;a&quot;</span>: <span class="number">2</span>, <span class="string">&quot;b&quot;</span>: <span class="number">3</span>&#125;))</span><br><span class="line">    <span class="built_in">print</span>(<span class="keyword">await</span> calculator.ainvoke(&#123;<span class="string">&quot;a&quot;</span>: <span class="number">2</span>, <span class="string">&quot;b&quot;</span>: <span class="number">5</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行异步主函数</span></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<p>可以配置自定义参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> StructuredTool</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CalculatorInput</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    a: <span class="built_in">int</span> = Field(description=<span class="string">&quot;first number&quot;</span>)</span><br><span class="line">    b: <span class="built_in">int</span> = Field(description=<span class="string">&quot;second number&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个异步包装器函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_addition</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Multiply two numbers.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    calculator = StructuredTool.from_function(</span><br><span class="line">        func=multiply,</span><br><span class="line">        name=<span class="string">&quot;Calculator&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;multiply numbers&quot;</span>,</span><br><span class="line">        args_schema=CalculatorInput,</span><br><span class="line">        return_direct=<span class="literal">True</span>,</span><br><span class="line">        <span class="comment">#coroutine= async_addition</span></span><br><span class="line">        <span class="comment"># coroutine= ... &lt;- 如果需要，也可以指定异步方法</span></span><br><span class="line">    )<span class="built_in">print</span>(calculator.invoke(&#123;<span class="string">&quot;a&quot;</span>: <span class="number">2</span>, <span class="string">&quot;b&quot;</span>: <span class="number">3</span>&#125;))</span><br><span class="line">    <span class="comment">#print(await calculator.ainvoke(&#123;&quot;a&quot;: 2, &quot;b&quot;: 5&#125;))</span></span><br><span class="line">    <span class="built_in">print</span>(calculator.name)</span><br><span class="line">    <span class="built_in">print</span>(calculator.description)</span><br><span class="line">    <span class="built_in">print</span>(calculator.args)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行异步主函数</span></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="处理工具错误"><a href="#处理工具错误" class="headerlink" title="处理工具错误"></a>处理工具错误</h3><p>如果您正在使用带有代理的工具，您可能需要一个错误处理策略，以便代理可以从错误中恢复并继续执行。 一个简单的策略是在工具内部抛出 <code>ToolException</code>，并使用 <code>handle_tool_error</code> 指定一个错误处理程序。 当指定了错误处理程序时，异常将被捕获，错误处理程序将决定从工具返回哪个输出。 您可以将 <code>handle_tool_error</code> 设置为 <code>True</code>、字符串值或函数。如果是函数，该函数应该以 <code>ToolException</code> 作为参数，并返回一个值。 请注意，仅仅抛出 <code>ToolException</code> 是不会生效的。您需要首先设置工具的 <code>handle_tool_error</code>，因为其默认值是 <code>False</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> ToolException</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">city: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取给定城市的天气。&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">raise</span> ToolException(<span class="string">f&quot;错误：没有名为<span class="subst">&#123;city&#125;</span>的城市。&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>下面是一个使用默认的 <code>handle_tool_error=True</code> 行为的示例。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例：tools_exception.py</span></span><br><span class="line">get_weather_tool = StructuredTool.from_function(</span><br><span class="line">    func=get_weather,</span><br><span class="line">    handle_tool_error=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">get_weather_tool.invoke(&#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;foobar&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;错误：没有名为foobar的城市。&#x27;</span><br></pre></td></tr></table></figure>

<p>我们可以将 <code>handle_tool_error</code> 设置为一个始终返回的字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例：tools_exception_handle.py</span></span><br><span class="line">get_weather_tool = StructuredTool.from_function(</span><br><span class="line">    func=get_weather,</span><br><span class="line">    handle_tool_error=<span class="string">&quot;没找到这个城市&quot;</span>,</span><br><span class="line">)</span><br><span class="line">get_weather_tool.invoke(&#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;foobar&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;没有这样的城市，但可能在那里的温度超过0K！&quot;</span><br></pre></td></tr></table></figure>

<p>使用函数处理错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例：tools_exception_handle_error.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_handle_error</span>(<span class="params">error: ToolException</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;工具执行期间发生以下错误：`<span class="subst">&#123;error.args[<span class="number">0</span>]&#125;</span>`&quot;</span></span><br><span class="line">get_weather_tool = StructuredTool.from_function(</span><br><span class="line">    func=get_weather,</span><br><span class="line">    handle_tool_error=_handle_error,</span><br><span class="line">)</span><br><span class="line">get_weather_tool.invoke(&#123;<span class="string">&quot;city&quot;</span>: <span class="string">&quot;foobar&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;工具执行期间发生以下错误：错误：没有名为foobar的城市。&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="二、调用内置工具包和拓展工具"><a href="#二、调用内置工具包和拓展工具" class="headerlink" title="二、调用内置工具包和拓展工具"></a>二、调用内置工具包和拓展工具</h2><h3 id="1-工具"><a href="#1-工具" class="headerlink" title="1. 工具"></a>1. 工具</h3><p>工具是代理、链或聊天模型&#x2F;LLM 用来与世界交互的接口。 一个工具由以下组件组成：</p>
<ol>
<li>工具的名称</li>
<li>工具的功能描述</li>
<li>工具输入的 JSON 模式</li>
<li>要调用的函数</li>
<li>工具的结果是否应直接返回给用户（仅对代理相关） 名称、描述和 JSON 模式作为上下文提供给 LLM，允许 LLM 适当地确定如何使用工具。 给定一组可用工具和提示，LLM 可以请求调用一个或多个工具，并提供适当的参数。 通常，在设计供聊天模型或 LLM 使用的工具时，重要的是要牢记以下几点：</li>
</ol>
<ul>
<li>经过微调以进行工具调用的聊天模型将比未经微调的模型更擅长进行工具调用。</li>
<li>未经微调的模型可能根本无法使用工具，特别是如果工具复杂或需要多次调用工具。</li>
<li>如果工具具有精心选择的名称、描述和 JSON 模式，则模型的性能将更好。</li>
<li>简单的工具通常比更复杂的工具更容易让模型使用。</li>
</ul>
<p>LangChain 拥有大量第三方工具。请访问<a target="_blank" rel="noopener" href="http://www.aidoczh.com/langchain/v0.2/docs/integrations/tools/">工具集成</a>查看可用工具列表。</p>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/integrations/tools/">https://python.langchain.com/v0.2/docs/integrations/tools/</a></p>
<p>在使用第三方工具时，请确保您了解工具的工作原理、权限情况。请阅读其文档，并检查是否需要从安全角度考虑任何事项。请查看<a target="_blank" rel="noopener" href="https://python.langchain.com/v0.1/docs/security/">安全</a>指南获取更多信息。</p>
<p>让我们尝试一下<a target="_blank" rel="noopener" href="http://www.aidoczh.com/langchain/v0.2/docs/integrations/tools/wikipedia/">维基百科集成</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install -qU wikipedia</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例：tools_wikipedia.py</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.tools <span class="keyword">import</span> WikipediaQueryRun</span><br><span class="line"><span class="keyword">from</span> langchain_community.utilities <span class="keyword">import</span> WikipediaAPIWrapper</span><br><span class="line">api_wrapper = WikipediaAPIWrapper(top_k_results=<span class="number">1</span>, doc_content_chars_max=<span class="number">100</span>)</span><br><span class="line">tool = WikipediaQueryRun(api_wrapper=api_wrapper)</span><br><span class="line"><span class="built_in">print</span>(tool.invoke(&#123;<span class="string">&quot;query&quot;</span>: <span class="string">&quot;langchain&quot;</span>&#125;))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Page: LangChain</span><br><span class="line">Summary: LangChain is a framework designed to simplify the creation of applications</span><br></pre></td></tr></table></figure>

<p>该工具具有以下默认关联项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Name: <span class="subst">&#123;tool.name&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Description: <span class="subst">&#123;tool.description&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;args schema: <span class="subst">&#123;tool.args&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;returns directly?: <span class="subst">&#123;tool.return_direct&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Name: wikipedia</span><br><span class="line">Description: A wrapper around Wikipedia. Useful for when you need to answer general questions about people, places, companies, facts, historical events, or other subjects. Input should be a search query.</span><br><span class="line">args schema: &#123;&#x27;query&#x27;: &#123;&#x27;title&#x27;: &#x27;Query&#x27;, &#x27;description&#x27;: &#x27;query to look up on wikipedia&#x27;, &#x27;type&#x27;: &#x27;string&#x27;&#125;&#125;</span><br><span class="line">returns directly?: False</span><br></pre></td></tr></table></figure>

<h3 id="2-自定义默认工具"><a href="#2-自定义默认工具" class="headerlink" title="2. 自定义默认工具"></a>2. 自定义默认工具</h3><p>我们还可以修改内置工具的名称、描述和参数的 JSON 模式。</p>
<p>在定义参数的 JSON 模式时，重要的是输入保持与函数相同，因此您不应更改它。但您可以轻松为每个输入定义自定义描述。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例：tools_custom.py</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.tools <span class="keyword">import</span> WikipediaQueryRun</span><br><span class="line"><span class="keyword">from</span> langchain_community.utilities <span class="keyword">import</span> WikipediaAPIWrapper</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WikiInputs</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;维基百科工具的输入。&quot;&quot;&quot;</span></span><br><span class="line">    query: <span class="built_in">str</span> = Field(</span><br><span class="line">        description=<span class="string">&quot;query to look up in Wikipedia, should be 3 or less words&quot;</span></span><br><span class="line">    )</span><br><span class="line">tool = WikipediaQueryRun(</span><br><span class="line">    name=<span class="string">&quot;wiki-tool&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;look up things in wikipedia&quot;</span>,</span><br><span class="line">    args_schema=WikiInputs,</span><br><span class="line">    api_wrapper=api_wrapper,</span><br><span class="line">    return_direct=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(tool.run(<span class="string">&quot;langchain&quot;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Page: LangChain</span><br><span class="line">Summary: LangChain is a framework designed to simplify the creation of applications </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Name: <span class="subst">&#123;tool.name&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Description: <span class="subst">&#123;tool.description&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;args schema: <span class="subst">&#123;tool.args&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;returns directly?: <span class="subst">&#123;tool.return_direct&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Name: wiki-tool</span><br><span class="line">Description: look up things in wikipedia</span><br><span class="line">args schema: &#123;&#x27;query&#x27;: &#123;&#x27;title&#x27;: &#x27;Query&#x27;, &#x27;description&#x27;: &#x27;query to look up in Wikipedia, should be 3 or less words&#x27;, &#x27;type&#x27;: &#x27;string&#x27;&#125;&#125;</span><br><span class="line">returns directly?: True</span><br></pre></td></tr></table></figure>

<h3 id="3-如何使用内置工具包"><a href="#3-如何使用内置工具包" class="headerlink" title="3. 如何使用内置工具包"></a>3. 如何使用内置工具包</h3><p>工具包是一组旨在一起使用以执行特定任务的工具。它们具有便捷的加载方法。</p>
<p>要获取可用的现成工具包完整列表，请访问<a target="_blank" rel="noopener" href="http://www.aidoczh.com/langchain/v0.2/docs/integrations/toolkits/">集成</a>。</p>
<p>所有工具包都公开了一个 <code>get_tools</code> 方法，该方法返回一个工具列表。</p>
<p>通常您应该这样使用它们：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化一个工具包</span></span><br><span class="line">toolkit = ExampleTookit(...)</span><br><span class="line"><span class="comment"># 获取工具列表</span></span><br><span class="line">tools = toolkit.get_tools()</span><br></pre></td></tr></table></figure>

<hr>
<p>例如，使用SQLDatabase toolkit 读取 langchain.db 数据库表结构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.agent_toolkits.sql.toolkit <span class="keyword">import</span> SQLDatabaseToolkit</span><br><span class="line"><span class="keyword">from</span> langchain_community.utilities <span class="keyword">import</span> SQLDatabase</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain_community.agent_toolkits.sql.base <span class="keyword">import</span> create_sql_agent</span><br><span class="line"><span class="keyword">from</span> langchain.agents.agent_types <span class="keyword">import</span> AgentType</span><br><span class="line"></span><br><span class="line">db = SQLDatabase.from_uri(<span class="string">&quot;sqlite:///langchain.db&quot;</span>)</span><br><span class="line">toolkit = SQLDatabaseToolkit(db=db, llm=ChatOpenAI(temperature=<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(toolkit.get_tools())</span><br><span class="line"></span><br><span class="line">agent_executor = create_sql_agent(</span><br><span class="line">    llm=ChatOpenAI(temperature=<span class="number">0</span>, model=<span class="string">&quot;gpt-4&quot;</span>),</span><br><span class="line">    toolkit=toolkit,</span><br><span class="line">    verbose=<span class="literal">True</span>,</span><br><span class="line">    agent_type=AgentType.OPENAI_FUNCTIONS</span><br><span class="line">)</span><br><span class="line"><span class="comment"># %%</span></span><br><span class="line">agent_executor.invoke(<span class="string">&quot;Describe the full_llm_cache table&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>执行 print(toolkit.get_tools())</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[QuerySQLDataBaseTool(description=<span class="string">&quot;Input to this tool is a detailed and correct SQL query, output is a result from the database. If the query is not correct, an error message will be returned. If an error is returned, rewrite the query, check the query, and try again. If you encounter an issue with Unknown column &#x27;xxxx&#x27; in &#x27;field list&#x27;, use sql_db_schema to query the correct table fields.&quot;</span>, db=&lt;langchain_community.utilities.sql_database.SQLDatabase <span class="built_in">object</span> at <span class="number">0x000001D15C9749B0</span>&gt;), InfoSQLDatabaseTool(description=<span class="string">&#x27;Input to this tool is a comma-separated list of tables, output is the schema and sample rows for those tables. Be sure that the tables actually exist by calling sql_db_list_tables first! Example Input: table1, table2, table3&#x27;</span>, db=&lt;langchain_community.utilities.sql_database.SQLDatabase <span class="built_in">object</span> at <span class="number">0x000001D15C9749B0</span>&gt;), ListSQLDatabaseTool(db=&lt;langchain_community.utilities.sql_database.SQLDatabase <span class="built_in">object</span> at <span class="number">0x000001D15C9749B0</span>&gt;), QuerySQLCheckerTool(description=<span class="string">&#x27;Use this tool to double check if your query is correct before executing it. Always use this tool before executing a query with sql_db_query!&#x27;</span>, db=&lt;langchain_community.utilities.sql_database.SQLDatabase <span class="built_in">object</span> at <span class="number">0x000001D15C9749B0</span>&gt;, llm=ChatOpenAI(client=&lt;openai.resources.chat.completions.Completions <span class="built_in">object</span> at <span class="number">0x000001D17B4453D0</span>&gt;, async_client=&lt;openai.resources.chat.completions.AsyncCompletions <span class="built_in">object</span> at <span class="number">0x000001D17B446D80</span>&gt;, temperature=<span class="number">0.0</span>, openai_api_key=SecretStr(<span class="string">&#x27;**********&#x27;</span>), openai_proxy=<span class="string">&#x27;&#x27;</span>), llm_chain=LLMChain(prompt=PromptTemplate(input_variables=[<span class="string">&#x27;dialect&#x27;</span>, <span class="string">&#x27;query&#x27;</span>], template=<span class="string">&#x27;\n&#123;query&#125;\nDouble check the &#123;dialect&#125; query above for common mistakes, including:\n- Using NOT IN with NULL values\n- Using UNION when UNION ALL should have been used\n- Using BETWEEN for exclusive ranges\n- Data type mismatch in predicates\n- Properly quoting identifiers\n- Using the correct number of arguments for functions\n- Casting to the correct data type\n- Using the proper columns for joins\n\nIf there are any of the above mistakes, rewrite the query. If there are no mistakes, just reproduce the original query.\n\nOutput the final SQL query only.\n\nSQL Query: &#x27;</span>), llm=ChatOpenAI(client=&lt;openai.resources.chat.completions.Completions <span class="built_in">object</span> at <span class="number">0x000001D17B4453D0</span>&gt;, async_client=&lt;openai.resources.chat.completions.AsyncCompletions <span class="built_in">object</span> at <span class="number">0x000001D17B446D80</span>&gt;, temperature=<span class="number">0.0</span>, openai_api_key=SecretStr(<span class="string">&#x27;**********&#x27;</span>), openai_proxy=<span class="string">&#x27;&#x27;</span>)))]</span><br></pre></td></tr></table></figure>

<p>执行：agent_executor.invoke(“Describe the full_llm_cache table”)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Entering new SQL Agent Executor chain...</span><br><span class="line">Invoking: sql_db_schema <span class="keyword">with</span> `&#123;<span class="string">&#x27;table_names&#x27;</span>: <span class="string">&#x27;full_llm_cache&#x27;</span>&#125;`</span><br><span class="line">CREATE TABLE full_llm_cache (</span><br><span class="line">        prompt VARCHAR NOT NULL,</span><br><span class="line">        llm VARCHAR NOT NULL,</span><br><span class="line">        idx INTEGER NOT NULL,</span><br><span class="line">        response VARCHAR,</span><br><span class="line">        PRIMARY KEY (prompt, llm, idx)</span><br><span class="line">)</span><br><span class="line">/*</span><br><span class="line"><span class="number">3</span> rows <span class="keyword">from</span> full_llm_cache table:</span><br><span class="line">prompt        llm        idx        response</span><br><span class="line">[&#123;<span class="string">&quot;lc&quot;</span>: <span class="number">1</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;langchain&quot;</span>, <span class="string">&quot;schema&quot;</span>, <span class="string">&quot;messages&quot;</span>, <span class="string">&quot;HumanMessage&quot;</span>], <span class="string">&quot;kwargs        &#123;&quot;</span><span class="built_in">id</span><span class="string">&quot;: [&quot;</span>langchain<span class="string">&quot;, &quot;</span>chat_models<span class="string">&quot;, &quot;</span>openai<span class="string">&quot;, &quot;</span>ChatOpenAI<span class="string">&quot;], &quot;</span>kwargs<span class="string">&quot;: &#123;&quot;</span>max_retries<span class="string">&quot;: 2, &quot;</span>model_nam        <span class="number">0</span>        &#123;<span class="string">&quot;lc&quot;</span>: <span class="number">1</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;langchain&quot;</span>, <span class="string">&quot;schema&quot;</span>, <span class="string">&quot;output&quot;</span>, <span class="string">&quot;ChatGeneration&quot;</span>], <span class="string">&quot;kwargs&quot;</span></span><br><span class="line">*/The `full_llm_cache` table has the following structure:</span><br><span class="line">- `prompt`: A VARCHAR field that <span class="keyword">is</span> part of the primary key. It cannot be NULL.</span><br><span class="line">- `llm`: A VARCHAR field that <span class="keyword">is</span> also part of the primary key. It cannot be NULL.</span><br><span class="line">- `idx`: An INTEGER field that <span class="keyword">is</span> part of the primary key <span class="keyword">as</span> well. It cannot be NULL.</span><br><span class="line">- `response`: A VARCHAR field that can contain NULL values.</span><br><span class="line">Here are some sample rows <span class="keyword">from</span> the `full_llm_cache` table:</span><br><span class="line">| prompt | llm | idx | response |</span><br><span class="line">|--------|-----|-----|----------|</span><br><span class="line">| [&#123;<span class="string">&quot;lc&quot;</span>: <span class="number">1</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;langchain&quot;</span>, <span class="string">&quot;schema&quot;</span>, <span class="string">&quot;messages&quot;</span>, <span class="string">&quot;HumanMessage&quot;</span>], <span class="string">&quot;kwargs | &#123;&quot;</span><span class="built_in">id</span><span class="string">&quot;: [&quot;</span>langchain<span class="string">&quot;, &quot;</span>chat_models<span class="string">&quot;, &quot;</span>openai<span class="string">&quot;, &quot;</span>ChatOpenAI<span class="string">&quot;], &quot;</span>kwargs<span class="string">&quot;: &#123;&quot;</span>max_retries<span class="string">&quot;: 2, &quot;</span>model_nam | <span class="number">0</span> | &#123;<span class="string">&quot;lc&quot;</span>: <span class="number">1</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;id&quot;</span>: [<span class="string">&quot;langchain&quot;</span>, <span class="string">&quot;schema&quot;</span>, <span class="string">&quot;output&quot;</span>, <span class="string">&quot;ChatGeneration&quot;</span>], <span class="string">&quot;kwargs&quot;</span> |</span><br><span class="line">&gt; Finished chain.</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>longchao
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://mzfnai.com/2025/07/05/179LangChain%E7%AF%87-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" title="LangChain篇-自定义工具调用">http://mzfnai.com/2025/07/05/179LangChain篇-自定义工具调用/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/LangChain/" rel="tag"># LangChain</a>
              <a href="/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7/" rel="tag"># 自定义工具</a>
              <a href="/tags/Tool%E8%A3%85%E9%A5%B0%E5%99%A8/" rel="tag"># Tool装饰器</a>
              <a href="/tags/Agent%E5%B7%A5%E5%85%B7/" rel="tag"># Agent工具</a>
              <a href="/tags/StructuredTool/" rel="tag"># StructuredTool</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/07/04/178LangChain%E7%AF%87-%E8%87%AA%E5%AE%9A%E4%B9%89Callback%E7%BB%84%E4%BB%B6/" rel="prev" title="LangChain篇-自定义Callback组件">
      <i class="fa fa-chevron-left"></i> LangChain篇-自定义Callback组件
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/07/06/180LangChain%E7%AF%87-%E8%87%AA%E5%AE%9A%E4%B9%89RAG%E5%8A%A0%E8%BD%BD%E5%99%A8/" rel="next" title="LangChain篇-自定义RAG加载器">
      LangChain篇-自定义RAG加载器 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-number">1.</span> <span class="nav-text">一、自定义工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-tool-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">1.1.</span> <span class="nav-text">1. @tool 装饰器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-StructuredTool"><span class="nav-number">1.2.</span> <span class="nav-text">2. StructuredTool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E9%94%99%E8%AF%AF"><span class="nav-number">1.3.</span> <span class="nav-text">处理工具错误</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%B0%83%E7%94%A8%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E5%8C%85%E5%92%8C%E6%8B%93%E5%B1%95%E5%B7%A5%E5%85%B7"><span class="nav-number">2.</span> <span class="nav-text">二、调用内置工具包和拓展工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B7%A5%E5%85%B7"><span class="nav-number">2.1.</span> <span class="nav-text">1. 工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%BB%98%E8%AE%A4%E5%B7%A5%E5%85%B7"><span class="nav-number">2.2.</span> <span class="nav-text">2. 自定义默认工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="nav-number">2.3.</span> <span class="nav-text">3. 如何使用内置工具包</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="longchao"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">longchao</p>
  <div class="site-description" itemprop="description">A blog about life, technology, and everything in between.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">247</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">76</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">627</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/longchao012" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;longchao012" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:longchao012@gmail.com" title="E-Mail → mailto:longchao012@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://plus.google.com/longchao012" title="Google → https:&#x2F;&#x2F;plus.google.com&#x2F;longchao012" rel="noopener" target="_blank"><i class="fa fa-fw fa-google"></i>Google</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">longchao</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">2.3m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">34:55</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
